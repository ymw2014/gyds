<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title></title>
<link rel="stylesheet" type="text/css" th:href="@{/pc/css/personal.css}" />
<!-- <link rel="stylesheet" th:href="@{/pc/css/zhaq.css}"> -->
<link rel="stylesheet" th:href="@{/pc/css/index.css}">
<link href="/css/layui.css" rel="stylesheet">
<script th:src="@{/pc/js/jquery-3.1.1.js}"></script>
<script th:src="@{/js/plugins/validate/jquery.validate.min.js}"></script>
<script th:src="@{/js/plugins/validate/messages_zh.min.js}"></script>
<script th:src="@{/js/validate.js}"></script>
<script src="/js/plugins/layer/layer.js"></script>
<script src="/js/layui.js"></script>
<link rel="stylesheet" th:href="@{/pc/css/jquery.my-modal.1.1.css}">
<script th:src="@{/pc/js/jquery.my-modal.1.1.js}"></script>
<script type="text/javascript" th:src="@{/mobile/js/jquery.my-modal.1.2.js}"></script>
<link rel="stylesheet" th:href="@{/mobile/css/jquery.my-modal.1.2.css}">
<style type="text/css">
	.zhezhaozh{
				position:absolute;
				width: 100%;
				height:100%;
				top: 0;
				bottom:1000;
				left: 0;
				right: 0;
				background:rgba(0,0,0,0.8);
				display: none;
			}
			.zhezhaozh1{
				width: 510px;
				height: auto;
				position: absolute;top:50%;left:50%;margin-left:-255px;margin-top:-900px;
				background: #fff;
			}
			.zhezhaozh1 p{
				font-size:14px;
				line-height:44px;
			}
			.zhezhaozh1 p>span{
				font-size:14px;
				color:#e0e1e3;
				margin-left:5px;
			}
			.zhezhaozh1 input{
				width: 420px;
				height:50px;
				font-size:16px;
			}
			.queren{
				background:#cd3333;
				color:#fff;
				border: none;
				margin-top:40px;
			}
			.guanbi{
				position:relative;left: 458px;top: 49px;
			}
			.qiana div {
            width: auto;
           color: #70a4ef;
         }
         .qiana a{
          color: #70a4ef;
         }
         .m-middletxt2-1 img{
           margin-top:0px;
         }
         .m-middletxt2-1 p{
                font-size: 30px;
                line-height: 80px;
         }
</style>
<style>
	.m-middletxt3 span{
	  display:block;
	  width:200px;
	  height:54px;
	  background:red;
	  color:#fff;
	  margin:0 auto;
	  text-align: center;
	  line-height: 54px;
      font-size: 26px;
      border-radius: 3px;
	  
     }
     .m-middletxt2{
      overflow: hidden;
     }
     .m-middletxt2 span{
	  display:block;
	  width:200px;
	  height:54px;
	  background:red;
	  color:#fff;
	  margin:0 auto;
	  text-align: center;
	  line-height: 54px;
      font-size: 26px;
      border-radius: 3px;
      margin-top:30px;
      
	  
     }
	</style>
</head>
<body>
	<div class="boxRight">
		<div class="NavCent">
			<!-- 账户中心 -->
			<div class="Navtext">
			<input type="hidden" th:value="${user.isBinding}" id="isBinding" />
				<figure>
					<a href=""><img th:src="${user.headImg}" alt=""></a>
					<figcaption>
						<input type="hidden" th:value="${user.userId}" id="id">
						<span th:text="${user.name}"> <img src="images/xingbie.jpg" alt=""></span>
						<p>
							 <font th:text="${'ID:'+user.userId}"></font> <i th:text="${user.isIdentification==1?'已实名':'未实名'}"></i>
						</p>
						<input type="hidden" id="userId" th:value="${user.userId}">
						
					</figcaption>
				</figure>
				<div class="xing" th:if="${le!=null}">
					<img th:each="i:${#numbers.sequence(1,le.level)}" th:src="${le.url}" alt=""> 
					<span th:text="${le.levelname}">5星志愿者</span>
				</div>
			</div>
			<div class="NavRight">
				<div class="Navstxt">
					<p>账户中心</p>
					<img src="images/yan.jpg" alt="">
				</div>
				<div class="NavCenter">
					<div>
					<input type="hidden" th:value="${ccount}" id="ccount">
						<span th:text="${ccount}"></span>
						<p>余额</p>
					</div>
					<div>
						<span th:text="${platformIntegral}"></span>
						<p>平台积分</p>
					</div>
				</div>
				<div class="qiana">
					<div>
						<div class="btn1" ><img src="images/tixian.jpg" alt="">充值</div>
						
					</div>
					<div>
						<div class="btn2" ><img src="images/chongzhi.jpg" alt="">提现</div>
					</div>
				</div>
			</div>
		</div>
		<!-- 我的发布 -->
		<div class="myright" th:if="${team!=null}">
			<div class="myrighttxt">
				<p>我的团队</p>
			</div>
			<div class="myrightimg">
				<a th:href="@{/pc/teamDetail?teamId=}+${team.id}+'&areaId=0'" target="_Parent"><img th:src="${team.teamTitleImg}" alt=""></a>
				<!-- <img id="code" src="http://127.0.0.1:9091/wxpay/pay" style="width:300px;height:300px;"/> -->
			</div>
			<p th:utext="${team.teamName+'<span>'+team.addres+'</span>'}"></p>

		</div>
		<!-- <div id="code" style="display: none">
			<img id="codeUrl" src="http://zhgy.61966.com/wxpay/pay" style="width:300px;height:300px;"/>
		</div> -->
		
	</div>
	<div class="m-modal">
			<div class="m-modal-dialog m-modal-dialog1">
				<div class="m-top">
					<span class="m-modal-close">X</span>
				</div>
				<div class="m-middle2">
				   <div class="m-middletxt">
					   <img th:src="${user.headImg}"alt="">
				   </div>
				   <div class="m-middletxt2">
				   		<ul>
							<li><a href="#">2</a>元</li>
							<li><a href="#">0.01</a>元</li>
							<li><a href="#">66</a>元</li>
							<li><a href="#">300</a>元</li>
							<li><a href="#">200</a>元</li>
							<li>
								<input id="pay" type="text" style="height: 81px;width:100%;
    								border: none;text-align: center; color:#dc1333" placeholder="自定义 (单位元)" onkeyup="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}" onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}">
							</li>
						</ul>
				   </div>
				   <div class="m-middletxt3">
					   <img src="images/03.png" alt="">
				   </div>
				</div>
			</div>
			<div class="m-modal-dialog m-modal-dialog5 adddd">
				<div class="m-top">
					<span class="m-modal-close">X</span>
				</div>
				<div class="m-middle2">
				   <div class="m-middletxt-1">
					  <img src="images/xccc.png" alt="">
				   </div>
				   <div class="m-middletxt2-1">
				       <p id="blance"></p>
					   <img id="codeUrl" src="" alt="">
				   </div>
				   <div class="m-middletxt3-1">
					   <img src="images/zasfaff.png" alt="">
				   </div>
				</div>
			</div>
		</div>
		<div class="m-modal1">
			<div class="m-modal1-dialog m-modal1-dialog1">
				<div class="m-top">
					<span class="m-modal1-close">X</span>
				</div>
				<div class="m-middle2">
				   <div class="m-middletxt">
					   <img th:src="${user.headImg}" alt="">
				   </div>
				   <div class="m-middletxt1">
				   		<ul id="cashOut">
							<li><a href="#">10元</a></li>
							<li><a href="#">66元</a></li>
							<li><a href="#">88元</a></li>
							<li><a href="#">300元</a></li>
							<li><a href="#">200元</a></li>
							<li><input id="cash" type="text" style="height: 81px;width:100%;
    								border: none;text-align: center; color:#dc1333" placeholder="自定义 (单位元)" onkeyup="if(this.value.length==1){this.value=this.value.replace(/[^1-9]+/g,'')}else{this.value=this.value.replace(/\D/g,'')}" onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^1-9]+/g,'')}else{this.value=this.value.replace(/\D/g,'')}">
    						</li>
						</ul>
				   </div>
				   <div class="m-middletxt2">   
					  <span>提 现</span>
				   </div>
				    <p th:text=" '最低提现10元，手续费利率为:' +  ${withdrawalFee}" style="text-align: center;margin-top: 18px;font-size: 20px;color: red;"></p>
				</div>
			</div>
		</div>
</body>

<script type="text/javascript">
function pay(){
	$("#code").show();
}

</script>
</html>
<script th:inline="javascript"> var ctx = [[@{/}]] ; </script>
<script type="text/javascript">
	var timer = '';
	var payFee = '';
	var cashOut = '';
	var m1 = new MyModal.modal(function() {
		alert("你点击了确定");
	});
	$('.btn1').on("click", function() {
		m1.show();
		
	});
	
	var m2 = new MyModal1.modal(function() {
		alert("你点击了确定");
	});
	$('.btn2').on("click", function() {
		m2.show();
	});
	
	$(".m-middletxt2 li").click(function(){
		$(this).addClass("addred").siblings("li").removeClass("addred");
		$('#pay').val('');
		var fee = $('.addred a').text();
		payFee = fee.match(/[\d.]+/g)[0];
		if($(this).index()==5){
			$(this).removeClass("addred");
		}
		
	})
	
	$(".m-middletxt1 li").click(function(){
		$(this).addClass("addredd").siblings("li").removeClass("addredd");
		$('#cash').val('');
		var fee = $('.addredd a').text();
		cashOut = fee.match(/[\d.]+/g)[0];
		
	})
	
	$('#pay').click(function(){
		payFee = '';
		if($(".m-middletxt2 li").hasClass("addred")){
			$(".m-middletxt2 li").removeClass("addred");
		}
	})
	
	$('#cash').click(function(){
		cashOut = '';
		if($(".m-middletxt1 li").hasClass("addredd")){
			$(".m-middletxt1 li").removeClass("addredd");
		}
	})
	$(".m-middletxt3 img").click(function(){
		if (payFee == '') {
			payFee = $('#pay').val();
		}
		if (payFee == '') {
			alert("请选择充值金额或输入充值金额");
			return;
		}
		
		$(".m-modal-dialog1").css("display","none")
		$(".adddd").css("display","block")
		$('#blance').text("充值金额 " +payFee + "元");
		var orderNum = createOrder(payFee);
		if (orderNum != '-1') {
			$('#codeUrl').attr("src","http://zhgy.61966.com/wxpay/pay?data=" + (payFee * 100) + "&orderNum=" + orderNum);
			timer = setInterval(function () {
					var msg = queryOrder(orderNum)
					if (msg == '1') {
						window.clearInterval(timer);
						history.go(0);
					}
				},500);
		} else {
			layer.msg("未知错误");
		}
	})
	
	
	$(".m-middletxt2 span").click(function(){
		$(".m-modal-dialog1").css("display","none")
		if (cashOut == '') {
			cashOut = $('#cash').val();
		}
		if (isNullOrBalance(cashOut)){
			return;
		};
		$(".m-modal1").css("display","none")
		var orderNum = createOrder(cashOut)
		 if(orderNum == '-1'){
			alert("订单创建失败")
		} else if(orderNum == '-2'){
			alert("提现金额不得低于10元")
		}else if(orderNum != '-1'){
			alert("订单创建成功")
		}
	})
	
	
	
	$(".m-modal-close").click(function(){
			history.go(0);
			$(".m-modal-dialog1").css("display","block")
			$(".adddd").css("display","none")
			window.clearInterval(timer);//清除定时器
	})
	
	function createOrder(fee){
		var orderNum = '';
		$.ajax({
			type : "POST",
			url : "/wxpay/createOrder",
			data : {'data': fee},
			async:false,
			success : function(r) {
				if (r.code == 0) {
					orderNum = r.msg;
				} else if(r.code == -1){
					orderNum =-1;
				}else if(r.code == -2){
					orderNum =-2;
				}
				}
		});
		return orderNum;
	}
	function queryOrder(orderNum){
		var stauts = '';
		$.ajax({
			type : "POST",
			url : "/wxpay/queryOrder",
			data : {'orderNum': orderNum},
			async:false,
			success : function(r) {
				if (r.code == 0) {
					orderNum = r.msg;
				} else if(r.code == -1){
					orderNum =-1;
				}else if(r.code == -2){
					orderNum =-2;
				}
				}
		});
		return stauts;
	}
	
	function createOrder(fee){
		var orderNum = '';
		$.ajax({
			type : "POST",
			url : "/cashout/createOrder",
			data : {'fee': fee},
			async:false,
			success : function(r) {
				if (r.code == 0) {
					orderNum = r.msg;
				} else if(r.code == -1){
					orderNum =-1;
				}else if(r.code == -2){
					orderNum =-2;
				}
				}
		});
		return orderNum;
	}
	function isNullOrBalance(fee){
		if (fee == '') {
			alert("请选择充值金额或输入充值金额");
			return true;
		}
		if((fee * 100) > ($('#ccount').val() * 100) ) {
			alert("余额不足");
			return true;
		}
	}
	
</script>
<script type="text/javascript">
	$(function(){
		var isBinding=$("#isBinding").val();
		console.log(isBinding);
		if(isBinding==""||isBinding==null||isBinding!=1){
			console.log($('.zhezhaozh',parent.document));
			/* $(".zhezhaozh").css("display","block");
			$("body").css("overflow", "hidden") */
			$('.zhezhaozh',parent.document).css("display","block");
			$("body",parent.document).css("overflow", "hidden") 
		}else{
			$('.zhezhaozh',parent.document).css("display","none");
			$("body",parent.document).css("overflow", "scroll") ;
		}
			
		$(".guanbi",parent.document).click(function(){
				$(".zhezhaozh",parent.document).css("display","none");
				$("body",parent.document).css("overflow", "scroll")
			})
	})
	
	$().ready(function() {
		$("#save",parent.document).on('click', function() {
			$("#userId",parent.document).val($("#id").val());
			$("#signupForm",parent.document).submit();
		});
	})
	$().ready(function() {
		validateRule();
	});
	
	$.validator.setDefaults({
		submitHandler : function() {
			tijiao();
		}
	});
	
	function tijiao() {
		var self = $(this);
		$.ajax({
			type : "POST",
			url : ctx + "pc/binding",
			data : $("#signupForm",parent.document).serialize(),
			success : function(r) {
				if (r.code == 0) {
					$(".zhezhaozh",parent.document).css("display","none");
					$("body",parent.document).css("overflow", "scroll")
				} else if (r.status == 500) {
					layer.msg(r.message);
					self.find(".check-tips").text(r.message);
				} else {
					layer.msg(r.msg);
					self.find(".check-tips").text(r.msg);
				}
			},
		});
	}
	
	function validateRule() {

		var icon = "</br><i class='fa fa-times-circle'></i> ";
		$("#signupForm",parent.document).validate({
			rules : {
				username : {
					required : true
				},
				password : {
					required : true
				},
				password1 : {
					required : true
				}
			},
			messages : {
				username : {
					required : icon + "<span style='color:red'>请输入您的用户名</span>",
				},
				password : {
					required : icon + "<span style='color:red'>请输入您的密码</span>",
				},
				password1 : {
					required : icon + "<span style='color:red'>两次密码输入需保持一致</span>",
				}
				
			}
		})
	}
	
</script>
</html>

