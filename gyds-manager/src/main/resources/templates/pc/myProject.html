<!DOCTYPE html>
<html>
	<head th:replace="pc/include :: head">
	<link rel="stylesheet" href="css/fenye.css">
	    <script th:src="@{/pc/js/jquery-3.1.1.js}"></script>
		<script type="text/javascript" src="js/fenye.js"></script>
	</head>
	<body>
		<div class="boxRight" style="background:#fff;margin-top:0;">
				<div class="gzzx">
					<h4>我的项目</h4>
					<ul class="dianli">
						<li class="hongdise"><a href="javaScript:;">我参与的项目 <span th:text="${teamSize}"></span></a></li>
						<li><a href="javaScript:;">我发布的项目 <span th:text="${actLSize}"></span></a></li>
					</ul>
				</div>
				 <!-- 参与的项目 -->
				<div class="yy-gz" style="margin-top:20px;display: block;">
					<div class="yymytd" th:each="pro: ${proList}">
					<input type="hidden" id="id" th:value="${pro.id}">
						<div class="yy-mytd1">
							<a href="#" target="_Parent"><img th:src="${pro.logo}"></a>
						</div>
						<div class="yy-mytd2">
							<h4 th:text="${pro.projectName}"></h4>
							<a href="javaScript:;" th:onclick="'javaScript:quit('+${pro.id}+')'" class="tuichu">退出</a>
							<div>
								<ul>
									<!-- <li>类型<span th:text="${pro.projectTypeName}"></span></li> -->
									<li>申请时间 <span th:text=" ${#dates.format(pro.createTime, 'yyyy-MM-dd HH:mm:ss')}"></span></li>
									<li>团队数 <span th:text="${pro.teamCount}"></span></li>
									<li th:if="${pro.duration==1}">到期时间 <span th:text="${#dates.format(pro.endTime, 'yyyy-MM-dd HH:mm:ss')}"></span></li>
									<li th:if="${pro.duration==2}">到期时间 <span>永久</span></li>
								</ul>
							</div>
							 <p style="padding-top:30px;font-size: 25px;color: red;" th:if="${pro.isDue}==2" th:onclick="'javascript:pay('+${pro.tickets}+')'" class="btn1">续费</p>
						</div>
					</div>
				 	</div>
					
				  <!-- 发布的项目  -->
				<div class="yy-gz"  style="margin-top:20px;">
					<div class="yy-gz1" style="padding-top: 30px;" th:each="puPro: ${puProList}">
							<img th:src="${puPro.logo}" alt="">
							<p th:text="${puPro.projectName}"></p>
							<div>发布时间<span style="margin-right:10px;" th:text=" ${#dates.format(puPro.createTime, 'yyyy-MM-dd HH:mm:ss')}"></span></div>
							<span style="color:#dd1230;line-height:42px;" th:text="${puPro.teamCount} +'团队'" id="applyNum"></span>
							<!-- <a id="anniu" href="javaScript:;" th:onclick="'javascript:apply(1,'+${act.news_id}+','+${act.appId}+')'" class="anniiu" th:if="${act.app_status eq 0}">取消报名</a>
							<a id="anniu" href="javaScript:;"  class="anniiu" th:if="${act.app_status eq 1}">已报名</a>
							<a id="anniu" href="javaScript:;" th:onclick="'javascript:apply(2,'+${act.news_id}+',-1)'" class="anniiu" th:if="${act.app_status eq -1}">立即报名</a> -->
					</div>
				</div>
			</div>
		<div class="m-modal">
			<div class="m-modal-dialog m-modal-dialog adddd">
				<div class="m-top">
					<span class="m-modal-close">X</span>
				</div>
				<div class="m-middle">
				   <div class="m-middletxt-1">
					  <img src="images/xccc.png" alt="">
				   </div>
				   <div class="m-middletxt2-1">
				       <p id="blance"></p>
					   <img id="codeUrl" src="" alt="">
				   </div>
				   <div class="m-middletxt3-1">
					   <img src="images/zasfaff.png" alt="">
				   </div>
				</div>
			</div>
		</div>
	</body>
	<style type="text/css">
		.tuichu{
			display: block !important;
			width:134px !important;
			height: 44px !important;
			background:#c11b25 !important;
			color:#f9f7f8 !important;
			position: absolute !important;
			margin-top:0 !important;
			right:48px;
			text-align: center;
			line-height:44px;
			border-radius:3px;
		}
		</style>
	<link rel="stylesheet" th:href="@{/mobile/css/jquery.my-modal.1.1.css}">
	<script type="text/javascript" th:src="@{/mobile/js/jquery.my-modal.1.1.js}"></script>
	<script type="text/javascript">
	webHeight = $('html').height();
	$(".J_iframe",parent.document).css("height",webHeight+'px')
	
	var m1 = new MyModal.modal(function(){
	});
	$('.btn1').on("click", function() {
	m1.show();
	});
	function pay(tickets){
		if(tickets==0){
			renew();
		}else{
			 $('#blance').text("付款金额 " +tickets + "元");
				$(".m-modal-dialog").css("display","none")
				$(".adddd").css("display","block")
			var orderNum = createOrder(tickets,15);
			if (orderNum != '-1') {
				$('#order').val(orderNum);
				$('#codeUrl').attr("src","http://www.48936.com/wxpay/pay?data=" + (tickets * 100) + "&orderNum=" + orderNum);
				timer = setInterval(function () {
						var msg = queryOrder(orderNum)
						if (msg == '1') {
							renew();
						}
					},500);
			} else {
				alert("未知错误");
			}
		}
	}
	
	
	function renew(){
		var id = $('#id').val();
		$.ajax({
			type : "POST",
			url : "/pc/proDue?id="+id,
			data : {},// 你的formid
			success : function(data) {
				if (data.code == 0) {
					alert("续费成功");
					history.go(0);
				} else {
					alert(data.msg);
				}

			}
		});
		
		
	}

	
	//创建订单
	function createOrder(fee,orderType){
		var orderNum = '';
		$.ajax({
			type : "POST",
			url : "/pc/news/createOrder",
			data : {'data': fee,
					'orderType':orderType},
			async:false,
			success : function(r) {
				if (r.code == 0) {
					orderNum = r.msg;
				} else if(r.code == -1){
					orderNum =-1;
				}else if(r.code == -2){
					orderNum =-2;
				}
				}
		});
		return orderNum;
	}
	//查询订单支付状态
	function queryOrder(orderNum){
		var stauts = '';
		$.ajax({
			type : "POST",
			url : "/wxpay/queryOrder",
			data : {'orderNum': orderNum},
			async:false,
			success : function(r) {
				if (r.code == 0) {
					stauts = r.msg;
				} else if(r.code == -1){
					stauts =-1;
				}else if(r.code == -2){
					stauts =-2;
				}
				}
		});
		return stauts;
	}
	$(".m-modal,.m-modal-close,.m-btn-cancel").on("click", function(event) {
		$('.m-modal').hide();
	});
	
	function quit(id) {
		layer.confirm('确定要退出项目？', {
			btn : [ '确定', '取消' ]
		}, function() {
			$.ajax({
				url : "/pc/quitProject",
				type : "post",
				data : {
					'id' : id
				},
				success : function(r) {
					if (r.code==0) {
						layer.msg(r.msg);
						reLoad();
					}else{
						layer.msg(r.msg);
					}
				}
			});
		})
	}
	</script>
</html>
<script>
	//$('.J_iframe',parent.document).css("height",webHeight+'px')
	$(".btn").mouseover(function(){
		 $(this).children("ul").show();
	});
	$(".btn").mouseout(function(){
		 $(this).children("ul").hide();
	})
	$('dt').click(function () {
		if($(this).nextUntil('dt','dd').is(':visible')){
			$(this).nextUntil('dt','dd').slideUp()
		}else{
			$(this).siblings('dd').slideUp().end().nextUntil('dt','dd').slideToggle();
		}
	});
	$('.dianli li').click(function() {
		$(this).addClass("hongdise").siblings("li").removeClass("hongdise");
		var index = $(this).index();
		$('.yy-gz').hide().eq($(this).index()).show();
		var webHeight = $(document).height();
		$('.J_iframe',parent.document).css("height",webHeight+'px')
	});
	$(".wyy-gz>div").click(function(){
		$(this).addClass("redborder").siblings("div").removeClass("redborder")
	})
	
	
</script>
